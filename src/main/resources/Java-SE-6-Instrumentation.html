<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0063)http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN" class="dj_webkit dj_chrome dj_contentbox"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Java SE 6
            新特性: Instrumentation 新功能</title>
<link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
<link rel="SHORTCUT ICON" href="http://www.ibm.com/favicon.ico">
<meta name="DC.Rights" content="© Copyright IBM Corporation 2007">
<meta name="Keywords" content="Java SE 6, Mustang, 新特性 , Instrumentation, transfor, 类定义 , JVM, Attach API, tttjca">
<meta name="DC.Date" scheme="iso8601" content="2007-05-16">
<meta name="Source" content="v17 delivery:developerWorks">
<meta name="Security" content="Public">
<meta name="Abstract" content="2006 年底，Sun 公司发布了 Java Standard Edition 6（Java SE 6）的最终正式版，代号 Mustang（野马）。跟 Tiger（Java SE 5）相比，Mustang 在性能方面有了不错的提升。与 Tiger 在 API 库方面的大幅度加强相比，虽然 Mustang 在 API 库方面的新特性显得不太多，但是也提供了许多实用和方便的功能：在脚本，WebService，XML，编译器 API，数据库，JMX，网络和 Instrumentation 方面都有不错的新特性和功能加强。本系列文章主要介绍 Java SE 6 在 API 库方面的部分新特性，通过一些例子和讲解，帮助开发者在编程实践当中更好的运用 Java SE 6，提高开发效率。本文是本系列的第一篇，介绍了 Java SE 6 在 Instrumentation 方面的新特性。">
<meta name="Description" content="2006 年底，Sun 公司发布了 Java Standard Edition 6（Java SE 6）的最终正式版，代号 Mustang（野马）。跟 Tiger（Java SE 5）相比，Mustang 在性能方面有了不错的提升。与 Tiger 在 API 库方面的大幅度加强相比，虽然 Mustang 在 API 库方面的新特性显得不太多，但是也提供了许多实用和方便的功能：在脚本，WebService，XML，编译器 API，数据库，JMX，网络和 Instrumentation 方面都有不错的新特性和功能加强。本系列文章主要介绍 Java SE 6 在 API 库方面的部分新特性，通过一些例子和讲解，帮助开发者在编程实践当中更好的运用 Java SE 6，提高开发效率。本文是本系列的第一篇，介绍了 Java SE 6 在 Instrumentation 方面的新特性。">
<meta name="IBM.Effective" scheme="W3CDTF" content="2007-05-16">
<meta name="Owner" content="developerWorks/China/IBM">
<meta name="DC.Language" scheme="rfc1766" content="zh-CN">
<meta name="IBM.SpecialPurpose" content="SP001">
<meta name="IBM.Country" content="CN">
<meta name="Robots" content="index,follow">
<meta name="DC.Type" scheme="IBM_ContentClassTaxonomy" content="CT316">
<meta name="DC.Subject" scheme="IBM_SubjectTaxonomy" content="TT300">
<meta name="dW.ContentArea" content="1">
<meta name="dW.Topic" content="125,695">

<meta scheme="IBM_WTMCategory" name="IBM.WTMCategory" content="SOFDCJVACN">

<link rel="canonical" href="./Java-SE-6-Instrumentation_files/Java-SE-6-Instrumentation.html">
<!-- HEADER_SCRIPTS_AND_CSS_INCLUDE -->
<link href="./Java-SE-6-Instrumentation_files/www.css" rel="stylesheet" title="www" type="text/css">
<link href="./Java-SE-6-Instrumentation_files/cnzh.css" rel="stylesheet" title="www" type="text/css">
<!-- Masthead/footer -->
<link href="./Java-SE-6-Instrumentation_files/dw-mfN2015-01.css" media="screen,projection" rel="stylesheet" title="www" type="text/css">
<link href="./Java-SE-6-Instrumentation_files/dw-article-6.css" rel="stylesheet" title="www" type="text/css">
<link href="./Java-SE-6-Instrumentation_files/dw-common-features.css" rel="stylesheet" title="www" type="text/css">
<link href="./Java-SE-6-Instrumentation_files/dw-local-site-v17-N2014-05.css" media="screen,projection" rel="stylesheet" title="www" type="text/css">
        <link href="./Java-SE-6-Instrumentation_files/dw-bluemix-regbar.css" media="screen,projection" rel="stylesheet" title="www" type="text/css">
<script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/eluminate.js" id="tealium_cormetrics1239"></script><script src="./Java-SE-6-Instrumentation_files/utag.js" type="text/javascript" async=""></script><script type="text/javascript" src="./Java-SE-6-Instrumentation_files/www.js">//</script><script type="text/javascript" src="./Java-SE-6-Instrumentation_files/eluminate(1).js"></script>
<script type="text/javascript" src="./Java-SE-6-Instrumentation_files/dw-www-v2.js">//</script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/Dialog.xd.js"></script>   
<script type="text/javascript">dojo.addOnLoad(function(){var dw_lang="zh_CN";var dw_source="dwchina";var dw_content=window.location.pathname.split("/")[window.location.pathname.split("/").length-2];if(dw_content=="library"){dw_content=window.location.pathname.split("/")[window.location.pathname.split("/").length-1];dw_content=window.location.pathname.split("/")[window.location.pathname.split("/").length-3]+"-"+dw_content.substring(0,dw_content.indexOf(".html"))}var lnkID="article-rbar-bmix-home-regbar";dojo.attr(dojo.query(".dw-regbar-btn")[0],"id",lnkID);var lnkHref=dojo.attr(dojo.byId(lnkID),"href")+"?lang="+dw_lang+"&ca="+dw_source+"-_-bluemix-_-"+dw_content+"-_-regbar-article";dojo.attr(dojo.byId(lnkID),"href",lnkHref);var rbstate=dojo.cookie("dwspck");if(rbstate==undefined)rbstate=0;rbstate=Number(rbstate);if(rbstate>=2)rbstate=0;if(rbstate==1){dojo.destroy("dw-regbar");return}var dwRegbarShow=dojo.animateProperty({node:"dw-regbar",duration:1000,delay:1000,properties:{opacity:{start:0,end:1},top:0}});var ibmTopSlideDown=dojo.animateProperty({node:"ibm-top",duration:1000,delay:1000,properties:{marginTop:{start:0,end:42}}});dwRegbarShow.play();ibmTopSlideDown.play();dwHideRegbar=function(){var dwRegbarHide=dojo.animateProperty({node:"dw-regbar",duration:1000,delay:0,properties:{opacity:{start:1,end:0},top:-100}});var ibmTopSlideUp=dojo.animateProperty({node:"ibm-top",duration:1000,delay:0,properties:{marginTop:{start:42,end:0}}});dwRegbarHide.play();ibmTopSlideUp.play();setTimeout(function(){dojo.destroy("dw-regbar")},1000);dojo.cookie("dwspck","1",{expires:3650,path:"/",domain:".ibm.com"})};});</script><script type="text/javascript">
//  ibmweb.config.set({ sbs: { enabled: false }});
</script>
<script type="text/javascript">dojo.addOnLoad(function(){var dw_lang="zh_CN";var dw_source="dwchina";var dw_register="注册免费的 Bluemix 试用版";var dw_connect="连接 Bluemix 开发者";var dw_vp="在 IBM Bluemix 云平台上开发并部署您的下一个应用。";var dw_cta="开始您的试用";var dw_tile_alt="在 IBM Bluemix 云平台上开发并部署您的下一个应用。现在就开始免费试用";var dw_campaign="bluemix";var dw_content=window.location.pathname.split("/")[window.location.pathname.split("/").length-2];if(dw_content=="library"){dw_content=window.location.pathname.split("/")[window.location.pathname.split("/").length-1];dw_content=window.location.pathname.split("/")[window.location.pathname.split("/").length-3]+"-"+dw_content.substring(0,dw_content.indexOf(".html"))}var bluDevComURL="https://developer.ibm.com/bluemix/";var bluLink="https://www.bluemix.net/";var lnkID;var lnkIDd;var lnkIDt;var bLinkEnd;var bLinkTemp;var idTrkr=[];var idCnt;var artTop=dojo.query("div.ibm-col-1-1")[0];var artChildren=dojo.query(artTop).children();var edgy=false;if(dojo.hasClass(artChildren[0],"ibm-inset"))edgy=true;if((artChildren[0].nodeName=="H2")&&(dojo.hasClass(artChildren[1],"ibm-inset")))edgy=true;if(dojo.hasClass(artChildren[0],"codesection"))edgy=true;if((artChildren[0].nodeName=="H5")&&(dojo.hasClass(artChildren[1],"codesection")))edgy=true;if((artChildren[0].nodeName=="H5")&&(artChildren[1].width>=701))edgy=true;if(artChildren[1].width>=701)edgy=true;if(dojo.hasClass(artChildren[0],"ibm-data-table"))edgy=true;if((artChildren[0].nodeName=="H5")&&(dojo.hasClass(artChildren[1],"ibm-data-table")))edgy=true;if(!(edgy)){var sBarAB='<div class="dw-article-sidebar dw-bluemix" id="dwc-exp-a">'+'<img src="//dw1.s81c.com/developerworks/i/bluemix-graphic.png" height="64" width="64" alt=""/>'+'<p>'+dw_vp+'</p>'+'<p class="ibm-button-link-alternate dw-button-green">'+'<a id="tutc-sbar-bmix-home-btn-ABa" href="'+bluLink+'" class="dw-button-large">'+dw_cta+'</a></p></div>';dojo.place(sBarAB,artTop,"first")}dojo.forEach(dojo.query("#ibm-content-main a"),function(item,index){var dw_medium="article";var bLink=dojo.attr(item,"href");var linkClass=dojo.attr(item,"class");if((dojo.attr(item,"id")!=null)&&(dojo.attr(item,"id").indexOf("-sbar-")>-1))dw_medium="sidebar";if((dojo.attr(item,"id")!=null)&&(dojo.attr(item,"id").indexOf("-vpromo-")>-1))dw_medium="video-promotion";if(bLink&&(bLink.indexOf("//bluemix.net")>-1))bLink=bLink.replace("//bluemix.net","//www.bluemix.net");if(bLink&&(bLink.indexOf("//ace.ng.bluemix.net")>-1))bLink=bLink.replace("//ace.ng.bluemix.net","//www.bluemix.net");if(bLink&&(bLink.indexOf("//console.ng.bluemix.net")>-1))bLink=bLink.replace("//console.ng.bluemix.net","//www.bluemix.net");if(bLink&&((bLink.indexOf("//www.bluemix.net")>-1)||(bLink.indexOf("//www.ng.bluemix.net")>-1)||(bLink.indexOf("//hub.jazz.net")>-1)||(bLink.indexOf("//developer.ibm.com/open")>-1))){bLinkEnd="";bLink=bLink.split("?");if((bLink[1])&&(bLink[1].indexOf("repository=")!=-1)){var deployBtn=true;bLink[0]=bLink[0]+"?"+bLink[1];bLink[1]=null}if((bLink[1])&&(bLink[1].indexOf("/")!=-1))bLinkEnd=bLink[1].substring(bLink[1].indexOf("/"));bLink=bLink[0];if(bLink.indexOf("//developer.ibm.com/open")==-1){if(bLink.indexOf("//hub.jazz.net")>-1){if(!(deployBtn)&&((bLink.indexOf("//hub.jazz.net/git")>-1)||(bLink.indexOf("//hub.jazz.net/project")>-1))){bLink=bLink+"?utm_source="+dw_source+"&utm_medium="+dw_medium+"&utm_content="+dw_content+"&utm_campaign="+dw_campaign}else{if(deployBtn){bLink=bLink+"&cm_mmc="+dw_source+"-_-"+dw_campaign+"-_-"+dw_content+"-_-"+dw_medium}else{bLink=bLink+"?utm_source="+dw_source+"&utm_campaign="+dw_campaign+"&utm_content="+dw_content+"&utm_medium="+dw_medium}}}else{if(bLink.indexOf("/#/")==-1){if(bLink.substring(bLink.length-7)=="/docs/#"){bLink=bLink.replace("/docs/#","/docs/"+"?cm_mmc="+dw_source+"-_-"+dw_campaign+"-_-"+dw_content+"-_-"+dw_medium)}else if(bLink.substring(bLink.length-5)=="/docs"){bLink=bLink.replace("/docs","/docs/"+"?cm_mmc="+dw_source+"-_-"+dw_campaign+"-_-"+dw_content+"-_-"+dw_medium)}else{bLink=bLink+"?cm_mmc="+dw_source+"-_-"+dw_campaign+"-_-"+dw_content+"-_-"+dw_medium}}else{bLink=bLink.substring(0,bLink.indexOf("#"))+"?cm_mmc="+dw_source+"-_-"+dw_campaign+"-_-"+dw_content+"-_-"+dw_medium+bLink.substring(bLink.indexOf("#")-1)}}if(bLinkEnd)bLink=bLink+bLinkEnd;if(linkClass.indexOf("bluemix-home")==-1){if((bLink.indexOf("#")==-1)&&(bLink.indexOf("/solutions")==-1)&&(bLink.indexOf("/catalog")==-1)&&(bLink.indexOf("//www.bluemix.net/")!=-1)){bLink=bLink.replace("//www.bluemix.net/","//developer.ibm.com/sso/bmregistration");if(bLink.indexOf("http://")==0)bLink=bLink.replace("http://","https://");if(bLink.indexOf("//")==0)bLink=bLink.replace("//","https://");if(bLink.indexOf("?cm_mmc=")!=-1)bLink=bLink.replace("?cm_mmc=","?lang="+dw_lang+"&ca=")}if((bLink.indexOf("#")==-1)&&(bLink.indexOf("/solutions")==-1)&&(bLink.indexOf("//www.bluemix.net?")!=-1)){bLink=bLink.replace("//www.bluemix.net","//developer.ibm.com/sso/bmregistration");if(bLink.indexOf("http://")==0)bLink=bLink.replace("http://","https://");if(bLink.indexOf("//")==0)bLink=bLink.replace("//","https://");if(bLink.indexOf("?cm_mmc=")!=-1)bLink=bLink.replace("?cm_mmc=","?lang="+dw_lang+"&ca=")}}if((bLink.indexOf("#")!=-1)&&(bLink.indexOf("solutions")!=-1)){bLinkTemp=bLink.substring(0,bLink.indexOf("?"));bLink=bLink.substring(bLink.indexOf("/#/")+3,bLink.length);bLink=bLinkTemp+bLink;bLinkTemp=bLink.substring(0,bLink.indexOf("solution="));bLink=bLink.substring(bLink.indexOf("/solution=")+10,bLink.length);bLink=bLinkTemp+bLink;bLink=bLink+"?cm_mmc="+dw_source+"-_-"+dw_campaign+"-_-"+dw_content+"-_-"+dw_medium}if((bLink.indexOf("#")!=-1)&&(bLink.indexOf("store")!=-1)){if(bLink.indexOf("&cloudOEPaneId=store")!=-1){bLinkTemp=bLink.split("&cloudOEPaneId=store");bLink=bLinkTemp[0]}bLinkTemp=bLink.substring(bLink.indexOf("serviceOfferingGuid=")+20,bLink.length);bLink=bLink.substring(0,bLink.indexOf(".net/")+5)+"catalog/"+bLinkTemp+"?cm_mmc="+dw_source+"-_-"+dw_campaign+"-_-"+dw_content+"-_-"+dw_medium}}dojo.attr(item,"href",bLink);}});});</script><!-- LEADSPACE_STYLES -->

<script type="text/javascript" src="./Java-SE-6-Instrumentation_files/cnzh-utf8.js" id="dojoIoScript2" charset="utf-8"></script><script type="text/javascript" src="./Java-SE-6-Instrumentation_files/saved_resource" id="dojoIoScript3" charset="utf-8"></script><script type="text/javascript" src="./Java-SE-6-Instrumentation_files/profiling.js" id="dojoIoScript4" charset="utf-8"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/move.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/TimedMoveable.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/_CssStateMixin.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/_FormMixin.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/_DialogMixin.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/DialogUnderlay.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/ContentPane.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/common.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/TooltipDialog.xd.js"></script><script type="text/javascript" src="./Java-SE-6-Instrumentation_files/blackwhite_lists.json" id="dojoIoScript5" charset="utf-8"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/Mover.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/Moveable.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/_ContentPaneResizeMixin.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/html.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/loading.xd.js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/common.xd(1).js"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/autoscroll.xd.js"></script><script type="text/javascript" src="./Java-SE-6-Instrumentation_files/atrk.js" id="dojoIoScript6" charset="utf-8"></script><script type="text/javascript" charset="utf-8" src="./Java-SE-6-Instrumentation_files/_LayoutWidget.xd.js"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.1239.js" id="utag_ibm.main_1239"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.694.js" id="utag_ibm.main_694"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.699.js" id="utag_ibm.main_699"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.752.js" id="utag_ibm.main_752"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.763.js" id="utag_ibm.main_763"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.797.js" id="utag_ibm.main_797"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.1150.js" id="utag_ibm.main_1150"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.1172.js" id="utag_ibm.main_1172"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.1197.js" id="utag_ibm.main_1197"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.1260.js" id="utag_ibm.main_1260"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.1278.js" id="utag_ibm.main_1278"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.1175.js" id="utag_ibm.main_1175"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/utag.v.js" id="tiqapp"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/i.js" id="tealium_setTTDid"></script><script language="javascript" type="text/javascript" src="./Java-SE-6-Instrumentation_files/50200000.js"></script><script language="javascript" type="text/javascript" src="./Java-SE-6-Instrumentation_files/50200000.js"></script><script language="javascript" type="text/javascript" src="./Java-SE-6-Instrumentation_files/cookie-id.js"></script><script language="javascript" type="text/javascript" src="./Java-SE-6-Instrumentation_files/rules_50200000.js"></script><script language="javascript" type="text/javascript" src="./Java-SE-6-Instrumentation_files/dispatcher-v3.js"></script><script language="javascript" type="text/javascript" src="./Java-SE-6-Instrumentation_files/cookie-id.js"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/i.js" id="tealium_setTTDid"></script><script src="./Java-SE-6-Instrumentation_files/yahoo-min.js" type="text/javascript"></script><script src="./Java-SE-6-Instrumentation_files/cp-v3.js" type="text/javascript"></script><script src="./Java-SE-6-Instrumentation_files/json-min.js" type="text/javascript"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/i.js" id="tealium_setTTDid"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/i.js" id="tealium_setTTDid"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/0151aa04b6ea001ff2b3a58151740506d004506500bd0" id="tealium_visitor_service_1175main"></script><script type="text/javascript" async="" charset="utf-8" src="./Java-SE-6-Instrumentation_files/0151aa04b6ea001ff2b3a58151740506d004506500bd0(1)" id="tealium_visitor_service_1175main"></script></head>
<body id="ibm-com" class="v17" aria-busy="false">
<div id="dw-regbar" class="dw-home-band" aria-labelledby="dw-regbar-vp" role="complementary" style="opacity: 1; top: 0px;">
    <div class="ibm-columns">
        <div class="ibm-col-6-6">
            <span id="dw-regbar-bluemix">IBM <strong>Bluemix</strong></span>
            <span id="dw-regbar-vp">点击按钮，开始云上的开发！</span>
            <p class="ibm-button-link-alternate dw-button-green">
                <a class="dw-button-large dw-regbar-btn" href="https://developer.ibm.com/sso/bmregistration?lang=zh_CN&ca=dwchina-_-bluemix-_-j-lo-jse61-_-regbar-article" id="article-rbar-bmix-home-regbar">开始您的试用</a>
            </p>
        </div>
    </div>
    <span>
        <a onclick="dwHideRegbar();" role="button">
            <span id="dw-close-regbar" aria-label="Close the registration bar" title="Close the registration bar" role="button">
        </span></a>
    </span>
</div>
	<div id="ibm-top" class="ibm-landing-page ibm-no-scroll" style="margin-top: 42px;"><img src="./Java-SE-6-Instrumentation_files/ibm_logo_print.png" width="43" height="15" id="ibm-print-masthead" alt="IBM Print">

<!-- MASTHEAD_BEGIN -->		
<div id="ibm-masthead" role="banner">

    <!-- TOP ROW -->    
	<div id="dw-masthead-top-row">
		<ul id="ibm-mast-options-dw" role="toolbar" aria-label="Masthead navigation">
			<li id="dw-mast-top-4" role="presentation">
				<a href="http://www.ibm.com/developerworks/cn/" tabindex="0"><img src="./Java-SE-6-Instrumentation_files/dwn-dw-badge.png" width="43" height="22" alt="dW" aria-label="dW"></a>
			</li>
			<li id="dw-mast-top-0" role="presentation">
				<div id="dw-mast-signin">
					<a id="dw-mf-signin-link" class="" href="http://www.ibm.com/developerworks/dwwi/jsp/ssologin.jsp?d=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html&lang=zh_CN&a=dwmav" title="" tabindex="2">登录</a>
					<span class="dw-mf-signin-spacer">|</span>
					<a id="dw-mf-reg-link" class="" href="http://www.ibm.com/developerworks/dwwi/jsp/ssoregister.jsp?d=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html&lang=zh_CN&a=dwmav" title="" tabindex="3">注册</a>
				</div>
				<div id="dw-mast-auth-link" class="dw-mf-hide">
					<a class="authenticated ibm-active" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#" role="button" tabindex="2"></a>
					<ul id="dw-mast-auth-menu" class="dw-mf-hide">
						<li class="dw-mast-auth-menu-title" aria-hidden="true">developerWorks 社区</li>
						<li>
							<span class="dw-mast-auth-menu-arrow" aria-hidden="true">›</span><a href="http://www.ibm.com/developerworks/community/profiles/html/myProfileView.do?lang=zh" tabindex="3">我的概要信息</a>
						</li>
						<li>
							<span class="dw-mast-auth-menu-arrow" aria-hidden="true">›</span><a href="http://www.ibm.com/developerworks/community/groups/service/html/mycommunities?lang=zh" tabindex="4">我的社区</a>
						</li>
						<li>
							<span class="dw-mast-auth-menu-arrow" aria-hidden="true">›</span><a href="http://www.ibm.com/developerworks/community/news/?lang=zh" tabindex="5">设置</a>
						</li>
						<li class="dw-mast-auth-menu-divider"><hr></li>
						<li>
							<span class="dw-mast-auth-menu-arrow" aria-hidden="true">›</span><a id="dw-mast-signout-link" href="http://www.ibm.com/developerworks/dwwi/jsp/ssologout.jsp?d=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2F&a=dwmav" tabindex="6">退出</a>
						</li>
					</ul>				
				</div>
			</li>
			<li id="dw-mast-top-1">
				<div></div>
			</li>
			<li id="dw-mast-top-3" role="presentation">
				<a href="http://www.ibm.com/cn/zh/" tabindex="1">IBM</a>
			</li>
		</ul>
	</div>

    <!-- BOTTOM ROW -->
	<div id="ibm-universal-nav-dw" aria-label="Site map">
		<ul id="ibm-unav-links-dw">
			<li id="ibm-unav-home-dwlogo">
				<a href="http://www.ibm.com/developerworks/cn/"><img src="./Java-SE-6-Instrumentation_files/dwn-dw-wordmark.png" width="225" height="28" alt="developerWorks®"></a>
			</li>
		</ul>
		<ul id="ibm-menu-links-dw" class="ibm-menu-links-dw-cn" role="toolbar" aria-label="Site map">
			<li id="dw-mast-nav-0" role="presentation"><a href="http://www.ibm.com/developerworks/cn/topics/" tabindex="0">技术主题</a></li>
			<li id="dw-mast-nav-1" role="presentation"><a href="http://www.ibm.com/developerworks/cn/downloads/" tabindex="0">软件下载</a></li>
			<li id="dw-mast-nav-2" role="presentation"><a href="http://www.ibm.com/developerworks/community/?lang=zh" tabindex="0">社区</a></li>
			<li id="dw-mast-nav-3" role="presentation"><a href="https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=6d7f9e5d-5f89-4767-a006-a81b8d186370&lang=zh" tabindex="0">技术讲座</a></li>
		</ul>
		<form id="ibm-search-form" action="http://www.ibm.com/search/csass/search/" method="get" name="form1" aria-label="搜索 developerWorks" role="search">
			<p>
				<label for="q"><span class="ibm-access">搜索 developerWorks</span></label>
				<input id="q" type="text" name="q" value="搜索 developerWorks" maxlength="100">
				<input type="hidden" name="sn" value="dw">
				<input type="hidden" name="lang" value="zh">
				<input type="hidden" name="cc" value="CN">
				<input type="hidden" name="en" value="utf">
				<input type="hidden" name="hpp" value="20">
				<input type="hidden" name="dws" value="cndw">
				<input type="hidden" name="lo" value="zh">
				<input id="ibm-search" class="ibm-btn-search" type="submit" value="提交">
			</p>
		</form>
	</div>    
	
<div id="ibm-social-tools" role="navigation" aria-label="社交工具" class="" style="display: block;"><ul role="toolbar" aria-label="Social tool list"><li><a class="ibm-share-print" title="打印本页面" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#" rel="print" dojoattrid="1" role="button" tabindex="0">打印本页面</a></li><li><a class="ibm-share-email" title="用电子邮件发送本页面" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#" rel="email" dojoattrid="2" role="button" tabindex="-1">用电子邮件发送本页面</a></li><li></li><li></li><li><a class="ibm-share-weibo" tabindex="-1" role="button" dojoattrid="2" rel="新浪微博" title="新浪微博" href="http://service.weibo.com/share/share.php?title=Java%20SE%206%20%E6%96%B0%E7%89%B9%E6%80%A7%3A%20Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD&url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html&language=zh_cn" onclick="ibmweb.sbs.clickHandler(event,{url:&#39;http://service.weibo.com/share/share.php?title=%{TITLE}&amp;url=%{URL}&amp;language=zh_cn&#39;});">新浪微博</a></li><li><a class="ibm-share-renren" tabindex="-1" role="button" dojoattrid="3" rel="人人网" title="人人网" href="http://share.renren.com/share/buttonshare?title=Java%20SE%206%20%E6%96%B0%E7%89%B9%E6%80%A7%3A%20Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD&link=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html" onclick="ibmweb.sbs.clickHandler(event,{url:&#39;http://share.renren.com/share/buttonshare?title=%{TITLE}&amp;link=%{URL}&#39;});">人人网</a></li><li><a class="dwcn-tencent-link" tabindex="-1" role="button" dojoattrid="4" rel="腾讯微博" title="腾讯微博" href="http://v.t.qq.com/share/share.php?title=Java%20SE%206%20%E6%96%B0%E7%89%B9%E6%80%A7%3A%20Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD&url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html" onclick="ibmweb.sbs.clickHandler(event,{url:&#39;http://v.t.qq.com/share/share.php?title=%{TITLE}&amp;url=%{URL}&#39;});">腾讯微博</a></li><li><a class="dwcn-sohu-link" tabindex="-1" role="button" dojoattrid="5" rel="搜狐微博" title="搜狐微博" href="http://t.sohu.com/third/post.jsp?title=Java%20SE%206%20%E6%96%B0%E7%89%B9%E6%80%A7%3A%20Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD%20&link=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html" onclick="ibmweb.sbs.clickHandler(event,{url:&#39;http://t.sohu.com/third/post.jsp?title=%{TITLE}%20&amp;link=%{URL}&#39;});">搜狐微博</a></li><li><a class="dwcn-netease-link" tabindex="-1" role="button" dojoattrid="6" rel="网易微博" title="网易微博" href="http://t.163.com/article/user/checkLogin.do?info=Java%20SE%206%20%E6%96%B0%E7%89%B9%E6%80%A7%3A%20Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD%20http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html" onclick="ibmweb.sbs.clickHandler(event,{url:&#39;http://t.163.com/article/user/checkLogin.do?info=%{TITLE}%20%{URL}&#39;});">网易微博</a></li><li><a class="ibm-share-digg" title="Digg" href="http://digg.com/submit?phase=2&url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html&title=Java%20SE%206%20%E6%96%B0%E7%89%B9%E6%80%A7%3A%20Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD" rel="digg" dojoattrid="7" role="button" tabindex="-1" onclick="ibmweb.sbs.clickHandler(event,{url:&#39;http://digg.com/submit?phase=2&amp;url=%{URL}&amp;title=%{TITLE}&#39;});">Digg</a></li><li><a class="ibm-share-facebook" title="Facebook" href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html&t=Java%20SE%206%20%E6%96%B0%E7%89%B9%E6%80%A7%3A%20Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD" rel="facebook" dojoattrid="8" role="button" tabindex="-1" onclick="ibmweb.sbs.clickHandler(event,{url:&#39;http://www.facebook.com/sharer.php?u=%{URL}&amp;t=%{TITLE}&#39;});">Facebook</a></li><li><a class="ibm-share-twitter" title="Twitter" href="http://twitter.com/?status=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html%20-%20Java%20SE%206%20%E6%96%B0%E7%89%B9%E6%80%A7%3A%20Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD" rel="twitter" dojoattrid="9" role="button" tabindex="-1" onclick="ibmweb.sbs.clickHandler(event,{url:&#39;http://twitter.com/?status=%{URL}%20-%20%{TITLE}&#39;});">Twitter</a></li><li><a class="ibm-share-delicious" title="Delicious" href="http://delicious.com/post?url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html&title=Java%20SE%206%20%E6%96%B0%E7%89%B9%E6%80%A7%3A%20Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD" rel="delicious" dojoattrid="10" role="button" tabindex="-1" onclick="ibmweb.sbs.clickHandler(event,{url:&#39;http://delicious.com/post?url=%{URL}&amp;title=%{TITLE}&#39;});">Delicious</a></li><li><a class="ibm-share-linkedin" title="Linked In" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html&title=Java%20SE%206%20%E6%96%B0%E7%89%B9%E6%80%A7%3A%20Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD" rel="linkedin" dojoattrid="11" role="button" tabindex="-1" onclick="ibmweb.sbs.clickHandler(event,{url:&#39;http://www.linkedin.com/shareArticle?mini=true&amp;url=%{URL}&amp;title=%{TITLE}&#39;});">Linked In</a></li></ul></div></div>
<div id="fdiv" class="ibm-access"></div><!-- MASTHEAD_END -->
	    
<!-- LAYOUT -->
<!-- LEADSPACE_BEGIN --> 
<div id="ibm-access-cntr" role="main"><div id="ibm-leadspace-head">
	<!-- LEADSPACE_BODY_BEGIN --> 
	<div id="ibm-leadspace-body">
		<!-- Navigation_Trail_BEGIN -->
      <ul id="ibm-navigation-trail" role="directory" aria-label="Bread Crumbs"><li><a href="http://www.ibm.com/developerworks/cn/">developerWorks 中国</a></li><li><a href="http://www.ibm.com/developerworks/cn/topics/">技术主题</a></li><li><a href="http://www.ibm.com/developerworks/cn/java/">Java technology</a></li><li><a href="http://www.ibm.com/developerworks/cn/views/java/libraryview.jsp">文档库</a></li></ul>
		<!-- END_Navigation_Trail -->
			<!-- Title_Subtitle -->
			<h1>Java SE 6
            新特性: Instrumentation 新功能</h1>
	</div>
	<!-- LEADSPACE_BODY_END --> 
	<!-- SUMMARY_BEGIN -->
	<div id="dw-summary-area" class="dw-summary-columns">
		<div class="ibm-col-6-4">
		<p></p><p xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">2006 年底，Sun 公司发布了 Java Standard Edition 6（Java SE
                6）的最终正式版，代号 Mustang（野马）。跟 Tiger（Java SE 5）相比，Mustang 在性能方面有了不错的提升。与 Tiger
                在 API 库方面的大幅度加强相比，虽然 Mustang 在 API
                库方面的新特性显得不太多，但是也提供了许多实用和方便的功能：在脚本，WebService，XML，编译器 API，数据库，JMX，网络和
                Instrumentation 方面都有不错的新特性和功能加强。<a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse6/"><em>本系列</em></a>文章主要介绍 Java SE 6 在 API
                库方面的部分新特性，通过一些例子和讲解，帮助开发者在编程实践当中更好的运用 Java SE 6，提高开发效率。</p><p>本文是 <a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse6/"><em>本系列</em></a>的第一篇，介绍了 Java SE 6 在 Instrumentation
            方面的新特性。</p><p></p>
		<p class="ibm-no-print ibm-ind-link">
<a class="ibm-forward-link" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse6/">查看本系列更多内容</a> <span class="dw-summary-bar">|</span>
			
			<span id="nCmts"><span>0</span><img class="dw-cmts-arrow" alt="" src="./Java-SE-6-Instrumentation_files/dw-cmts-arrow.png" height="7" width="7"> <a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#icomments" class="dw-cmt-link">评论：</a></span>
		</p>
		</div>
		<div class="ibm-col-6-2 dw-toc-margin">
			<p class="dw-summary-author"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#authorN1001E" class="ibm-popup-link" onclick="ibmweb.overlay.show(&#39;authorN1001E&#39;,this);return false;" role="button">胡 睿</a> (<a href="mailto:ruihu@cn.ibm.com?subject=Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD">ruihu@cn.ibm.com</a>), 软件工程师, IBM</p>
<div id="authorN1001E" class="ibm-common-overlay"><div class="ibm-head"><p><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#close" class="ibm-common-overlay-close">关闭 [x]</a></p></div><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><!--this is where the h2 usually
                                    goes--></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body">
<p><!--.-->
<img class="dw-summary-bio-image-x64" alt="Author1 photo" src="./Java-SE-6-Instrumentation_files/robert.jpg" width="64">胡睿，目前就职于 IBM 中国开发中心 Harmony 开发团队。 主要负责类库开发的技术工作，对 J2SE、J2EE、C/C++、全球化技术、软件测试等有浓厚的兴趣。另外，他对历史、电影、音乐与羽毛球等也十分热爱。您可以通过<a href="mailto:ruihu@cn.ibm.com">ruihu@cn.ibm.com</a>联系到他。</p><br><br></div></div></div></div><div class="ibm-footer"><!----></div></div>
<p class="dw-summary-author"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#authorN10035" class="ibm-popup-link" onclick="ibmweb.overlay.show(&#39;authorN10035&#39;,this);return false;" role="button">吕 晶</a> (<a href="mailto:purefire@126.com?subject=Instrumentation%20%E6%96%B0%E5%8A%9F%E8%83%BD">purefire@126.com</a>), 软件工程师, IBM</p>
<div id="authorN10035" class="ibm-common-overlay"><div class="ibm-head"><p><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#close" class="ibm-common-overlay-close">关闭 [x]</a></p></div><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><!--this is where the h2 usually
                                    goes--></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body">
<p><!--.-->
<img class="dw-summary-bio-image-x64" alt="吕 晶" align="" name="author&#39;s photo" src="./Java-SE-6-Instrumentation_files/lvjing.jpg" valign="top">吕晶对计算机科学，开源软件，和新鲜事物都抱有浓厚的兴趣。</p><br><br></div></div></div></div><div class="ibm-footer"><!----></div></div>
			<p class="dw-summary-date">2007 年 5 月 16 日</p>
			


			<div aria-hidden="true" class="ibm-container" id="dw-toc"><div class="ibm-container-body"><ul class="ibm-twisty"><li><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#toggle" class="ibm-twisty-trigger ibm-twisty-trigger-closed"><img src="./Java-SE-6-Instrumentation_files/c.gif" alt="expand"></a><span class="ibm-twisty-head">内容</span><div class="ibm-twisty-body" style="display: none;"><ul style="font-size:0.8em" class="ibm-link-list">
<li><a class="ibm-anchor-down-em-link" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#N1005F">Instrumentation
                简介</a></li>
<li><a class="ibm-anchor-down-em-link" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#N1006F">Instrumentation
                的基本功能和用法</a></li>
<li><a class="ibm-anchor-down-em-link" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#N100E9">Java SE 6
                的新特性：虚拟机启动后的动态 instrument</a></li>
<li><a class="ibm-anchor-down-em-link" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#N1012F">Java SE 6 新特性：本地方法的
                Instrumentation</a></li>
<li><a class="ibm-anchor-down-em-link" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#N101A1">Java SE 6
                新特性：BootClassPath / SystemClassPath 的动态增补</a></li>
<li><a class="ibm-anchor-down-em-link" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#N101B5">结语</a></li>
<li><a class="ibm-anchor-down-em-link" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#resources">参考资料 </a></li>
<li><a class="ibm-anchor-down-em-link" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#icomments">评论</a></li></ul></div></li></ul></div></div>
		</div>
	</div>
	<!-- SUMMARY_END -->
</div><div id="ibm-pcon">

<!-- BEGIN_IBM-CONTENT -->
<div id="ibm-content">

<!-- BEGIN_IBM-CONTENT-BODY -->
<div id="ibm-content-body">

<!-- BEGIN_IBM-CONTENT-MAIN -->
<div id="ibm-content-main">

<!-- 1_1_COLUMN_BEGIN -->
<div class="ibm-columns">
<div class="ibm-col-1-1"><div class="dw-article-sidebar dw-bluemix" id="dwc-exp-a"><img src="./Java-SE-6-Instrumentation_files/bluemix-graphic.png" height="64" width="64" alt=""><p>在 IBM Bluemix 云平台上开发并部署您的下一个应用。</p><p class="ibm-button-link-alternate dw-button-green"><a id="tutc-sbar-bmix-home-btn-ABa" href="https://developer.ibm.com/sso/bmregistration?lang=zh_CN&ca=dwchina-_-bluemix-_-j-lo-jse61-_-sidebar" class="dw-button-large">开始您的试用</a></p></div>

<h2 id="N1005F">Instrumentation
                简介</h2><p>利用 Java 代码，即 java.lang.instrument 做动态 Instrumentation 是 Java SE 5 的新特性，它把
                Java 的 instrument 功能从本地代码中解放出来，使之可以用 Java 代码的方式解决问题。使用
                Instrumentation，开发者可以构建一个独立于应用程序的代理程序（Agent），用来监测和协助运行在 JVM
                上的程序，甚至能够替换和修改某些类的定义。有了这样的功能，开发者就可以实现更为灵活的运行时虚拟机监控和 Java
                类操作了，这样的特性实际上提供了一种虚拟机级别支持的 AOP 实现方式，使得开发者无需对 JDK 做任何升级和改动，就可以实现某些 AOP
                的功能了。</p><p>在 Java SE 6 里面，instrumentation 包被赋予了更强大的功能：启动后的 instrument、本地代码（native
                code）instrument，以及动态改变 classpath 等等。这些改变，意味着 Java 具有了更强的动态控制、解释能力，它使得 Java
                语言变得更加灵活多变。</p><p>在 Java SE6 里面，最大的改变使运行时的 Instrumentation 成为可能。在 Java SE 5 中，Instrument
                要求在运行前利用命令行参数或者系统参数来设置代理类，在实际的运行之中，虚拟机在初始化之时（在绝大多数的 Java
                类库被载入之前），instrumentation
                的设置已经启动，并在虚拟机中设置了回调函数，检测特定类的加载情况，并完成实际工作。但是在实际的很多的情况下，我们没有办法在虚拟机启动之时就为其设定代理，这样实际上限制了
                instrument 的应用。而 Java SE 6 的新特性改变了这种情况，通过 Java Tool API 中的 attach
                方式，我们可以很方便地在运行过程中动态地设置加载代理类，以达到 instrumentation 的目的。</p><p>另外，对 native 的 Instrumentation 也是 Java SE 6 的一个崭新的功能，这使以前无法完成的功能 —— 对 native
                接口的 instrumentation 可以在 Java SE 6 中，通过一个或者一系列的 prefix 添加而得以完成。</p><p>最后，Java SE 6 里的 Instrumentation 也增加了动态添加 class path 的功能。所有这些新的功能，都使得
                instrument 包的功能更加丰富，从而使 Java 语言本身更加强大。</p><div class="ibm-alternate-rule"><hr></div><p class="ibm-ind-link ibm-back-to-top"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><h2 id="N1006F">Instrumentation
                的基本功能和用法</h2><p>“java.lang.instrument”包的具体实现，依赖于 JVMTI。JVMTI（Java Virtual Machine Tool
                Interface）是一套由 Java 虚拟机提供的，为 JVM 相关的工具提供的本地编程接口集合。JVMTI 是从 Java SE 5
                开始引入，整合和取代了以前使用的 Java Virtual Machine Profiler Interface (JVMPI) 和 the
                Java Virtual Machine Debug Interface (JVMDI)，而在 Java SE 6 中，JVMPI 和 JVMDI
                已经消失了。JVMTI 提供了一套”代理”程序机制，可以支持第三方工具程序以代理的方式连接和访问 JVM，并利用 JVMTI
                提供的丰富的编程接口，完成很多跟 JVM 相关的功能。事实上，java.lang.instrument 包的实现，也就是基于这种机制的：在
                Instrumentation 的实现当中，存在一个 JVMTI 的代理程序，通过调用 JVMTI 当中 Java 类相关的函数来完成 Java
                类的动态操作。除开 Instrumentation 功能外，JVMTI
                还在虚拟机内存管理，线程控制，方法和变量操作等等方面提供了大量有价值的函数。关于 JVMTI 的详细信息，请参考 Java SE 6 文档（请参见
                    <a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#resources">参考资源</a>）当中的介绍。</p><p>Instrumentation 的最大作用，就是类定义动态改变和操作。在 Java SE 5 及其后续版本当中，开发者可以在一个普通 Java
                程序（带有 main 函数的 Java 类）运行时，通过 <code>– javaagent</code>参数指定一个特定的 jar 文件（包含
                Instrumentation 代理）来启动 Instrumentation 的代理程序。</p><p>在 Java SE 5 当中，开发者可以让 Instrumentation 代理在 main 函数运行前执行。简要说来就是如下几个步骤：</p><ol><li><strong>编写 premain 函数</strong><p>编写一个 Java 类，包含如下两个方法当中的任何一个</p><div class="codesection"><pre class="displaycode">public static void premain(String agentArgs, Instrumentation inst);  [1]
public static void premain(String agentArgs); [2]</pre></div><p>其中，[1] 的优先级比 [2] 高，将会被优先执行（[1] 和 [2] 同时存在时，[2] 被忽略）。</p><p>在这个
                        premain 函数中，开发者可以进行对类的各种操作。</p><p>agentArgs 是 premain 函数得到的程序参数，随同
                        “<code>– javaagent</code>”一起传入。与 main
                        函数不同的是，这个参数是一个字符串而不是一个字符串数组，如果程序参数有多个，程序将自行解析这个字符串。</p><p>Inst 是一个
                        java.lang.instrument.Instrumentation 的实例，由 JVM
                        自动传入。java.lang.instrument.Instrumentation 是 instrument
                        包中定义的一个接口，也是这个包的核心部分，集中了其中几乎所有的功能方法，例如类定义的转换和操作等等。</p></li><li><strong>jar 文件打包</strong><p>将这个 Java 类打包成一个 jar 文件，并在其中的 manifest
                        属性当中加入” Premain-Class”来指定步骤 1 当中编写的那个带有 premain 的 Java
                        类。（可能还需要指定其他属性以开启更多功能）</p></li><li><strong>运行</strong><p>用如下方式运行带有 Instrumentation 的 Java 程序：</p><div class="codesection"><pre class="displaycode"> java -javaagent:jar 文件的位置 [= 传入 premain 的参数 ]</pre></div></li></ol><p>对 Java 类文件的操作，可以理解为对一个 byte 数组的操作（将类文件的二进制字节流读入一个 byte
                数组）。开发者可以在“ClassFileTransformer”的 transform 方法当中得到，操作并最终返回一个类的定义（一个 byte
                数组）。这方面，Apache 的 BCEL 开源项目提供了强有力的支持，读者可以在参考文章“<a href="http://www.ibm.com/developerworks/cn/java/j-lo-instrumentation/">Java SE 5 特性 Instrumentation 实践</a>”中看到一个 BCEL 和 Instrumentation
                结合的例子。具体的字节码操作并非本文的重点，所以，本文中所举的例子，只是采用简单的类文件替换的方式来演示 Instrumentation
                的使用。</p><p>下面，我们通过简单的举例，来说明 Instrumentation 的基本使用方法。</p><p>首先，我们有一个简单的类，TransClass， 可以通过一个静态方法返回一个整数 1。</p><div class="codesection"><pre class="displaycode"> public class TransClass { 
	 public int getNumber() { 
	 return 1; 
    } 
 }</pre></div><p>我们运行如下类，可以得到输出 ”1“。</p><div class="codesection"><pre class="displaycode"> public class TestMainInJar { 
    public static void main(String[] args) { 
        System.out.println(new TransClass().getNumber()); 
    } 
 }</pre></div><p>然后，我们将 TransClass 的 getNumber 方法改成如下 :</p><div class="codesection"><pre class="displaycode"> public int getNumber() { 
        return 2; 
 }</pre></div><p>再将这个返回 2 的 Java 文件编译成类文件，为了区别开原有的返回 1 的类，我们将返回 2 的这个类文件命名为
                TransClass2.class.2。</p><p>接下来，我们建立一个 Transformer 类：</p><div class="codesection"><pre class="displaycode"> import java.io.File; 
 import java.io.FileInputStream; 
 import java.io.IOException; 
 import java.io.InputStream; 
 import java.lang.instrument.ClassFileTransformer; 
 import java.lang.instrument.IllegalClassFormatException; 
 import java.security.ProtectionDomain; 

 class Transformer implements ClassFileTransformer { 

    public static final String classNumberReturns2 = "TransClass.class.2"; 

    public static byte[] getBytesFromFile(String fileName) { 
        try { 
            // precondition 
            File file = new File(fileName); 
            InputStream is = new FileInputStream(file); 
            long length = file.length(); 
            byte[] bytes = new byte[(int) length]; 

            // Read in the bytes 
            int offset = 0; 
            int numRead = 0; 
            while (offset &lt;bytes.length 
                    &amp;&amp; (numRead = is.read(bytes, offset, bytes.length - offset)) &gt;= 0) { 
                offset += numRead; 
            } 

            if (offset &lt; bytes.length) { 
                throw new IOException("Could not completely read file "
                        + file.getName()); 
            } 
            is.close(); 
            return bytes; 
        } catch (Exception e) { 
            System.out.println("error occurs in _ClassTransformer!"
                    + e.getClass().getName()); 
            return null; 
        } 
    } 

    public byte[] transform(ClassLoader l, String className, Class&lt;?&gt; c, 
            ProtectionDomain pd, byte[] b) throws IllegalClassFormatException { 
        if (!className.equals("TransClass")) { 
            return null; 
        } 
        return getBytesFromFile(classNumberReturns2); 

    } 
 }</pre></div><p>这个类实现了 ClassFileTransformer 接口。其中，getBytesFromFile 方法根据文件名读入二进制字符流，而
                ClassFileTransformer 当中规定的 transform 方法则完成了类定义的替换转换。</p><p>最后，我们建立一个 Premain 类，写入 Instrumentation 的代理方法 premain：</p><div class="codesection"><pre class="displaycode"> public class Premain { 
    public static void premain(String agentArgs， Instrumentation inst) 
            throws ClassNotFoundException， UnmodifiableClassException { 
        inst.addTransformer(new Transformer()); 
    } 
 }</pre></div><p>可以看出，addTransformer 方法并没有指明要转换哪个类。转换发生在 premain 函数执行之后，main
                函数执行之前，这时每装载一个类，transform 方法就会执行一次，看看是否需要转换，所以，在 transform（Transformer
                类中）方法中，程序用 className.equals("TransClass") 来判断当前的类是否需要转换。</p><p>代码完成后，我们将他们打包为 TestInstrument1.jar。返回 1 的那个 TransClass 的类文件保留在 jar 包中，而返回 2
                的那个 TransClass.class.2 则放到 jar 的外面。在 manifest 里面加入如下属性来指定 premain
                所在的类：</p><div class="codesection"><pre class="displaycode"> Manifest-Version: 1.0 
 Premain-Class: Premain</pre></div><p>在运行这个程序的时候，如果我们用普通方式运行这个 jar 中的 main 函数，可以得到输出“1”。如果用下列方式运行 :</p><div class="codesection"><pre class="displaycode"> java – javaagent:TestInstrument1.jar – cp TestInstrument1.jar TestMainInJar</pre></div><p>则会得到输出“2”。</p><p>当然，程序运行的 main 函数不一定要放在 premain 所在的这个 jar 文件里面，这里只是为了例子程序打包的方便而放在一起的。</p><p>除开用 addTransformer 的方式，Instrumentation 当中还有另外一个方法“redefineClasses”来实现
                premain 当中指定的转换。用法类似，如下：</p><div class="codesection"><pre class="displaycode"> public class Premain { 
    public static void premain(String agentArgs， Instrumentation inst) 
            throws ClassNotFoundException， UnmodifiableClassException { 
        ClassDefinition def = new ClassDefinition(TransClass.class， Transformer 
                .getBytesFromFile(Transformer.classNumberReturns2)); 
        inst.redefineClasses(new ClassDefinition[] { def }); 
        System.out.println("success"); 
    } 
 }</pre></div><p>redefineClasses 的功能比较强大，可以批量转换很多类。</p><div class="ibm-alternate-rule"><hr></div><p class="ibm-ind-link ibm-back-to-top"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><h2 id="N100E9">Java SE 6
                的新特性：虚拟机启动后的动态 instrument</h2><p>在 Java SE 5 当中，开发者只能在 premain 当中施展想象力，所作的 Instrumentation 也仅限与 main
                函数执行前，这样的方式存在一定的局限性。</p><p>在 Java SE 5 的基础上，Java SE 6 针对这种状况做出了改进，开发者可以在 main 函数开始执行以后，再启动自己的
                Instrumentation 程序。</p><p>在 Java SE 6 的 Instrumentation 当中，有一个跟 premain“并驾齐驱”的“agentmain”方法，可以在 main
                函数开始运行之后再运行。</p><p>跟 premain 函数一样， 开发者可以编写一个含有“agentmain”函数的 Java 类：</p><div class="codesection"><pre class="displaycode"> public static void agentmain (String agentArgs, Instrumentation inst); 		 [1] 
 public static void agentmain (String agentArgs); 			 [2]</pre></div><p>同样，[1] 的优先级比 [2] 高，将会被优先执行。</p><p>跟 premain 函数一样，开发者可以在 agentmain 中进行对类的各种操作。其中的 agentArgs 和 Inst 的用法跟
                premain 相同。</p><p>与“Premain-Class”类似，开发者必须在 manifest 文件里面设置“Agent-Class”来指定包含 agentmain
                函数的类。</p><p>可是，跟 premain 不同的是，agentmain 需要在 main
                函数开始运行后才启动，这样的时机应该如何确定呢，这样的功能又如何实现呢？</p><p>在 Java SE 6 文档当中，开发者也许无法在 java.lang.instrument 包相关的文档部分看到明确的介绍，更加无法看到具体的应用
                agnetmain 的例子。不过，在 Java SE 6 的新特性里面，有一个不太起眼的地方，揭示了 agentmain 的用法。这就是 Java
                SE 6 当中提供的 Attach API。</p><p>Attach API 不是 Java 的标准 API，而是 Sun 公司提供的一套扩展 API，用来向目标 JVM
                ”附着”（Attach）代理工具程序的。有了它，开发者可以方便的监控一个 JVM，运行一个外加的代理程序。</p><p>Attach API 很简单，只有 2 个主要的类，都在 com.sun.tools.attach 包里面： VirtualMachine 代表一个
                Java 虚拟机，也就是程序需要监控的目标虚拟机，提供了 JVM 枚举，Attach 动作和 Detach 动作（Attach 动作的相反行为，从
                JVM 上面解除一个代理）等等 ; VirtualMachineDescriptor 则是一个描述虚拟机的容器类，配合 VirtualMachine
                类完成各种功能。</p><p>为了简单起见，我们举例简化如下：依然用类文件替换的方式，将一个返回 1 的函数替换成返回 2 的函数，Attach API
                写在一个线程里面，用睡眠等待的方式，每隔半秒时间检查一次所有的 Java 虚拟机，当发现有新的虚拟机出现的时候，就调用 attach
                函数，随后再按照 Attach API 文档里面所说的方式装载 Jar 文件。等到 5 秒钟的时候，attach 程序自动结束。而在 main
                函数里面，程序每隔半秒钟输出一次返回值（显示出返回值从 1 变成 2）。</p><p>TransClass 类和 Transformer 类的代码不变，参看上一节介绍。 含有 main 函数的 TestMainInJar
                代码为：</p><div class="codesection"><pre class="displaycode"> public class TestMainInJar { 
    public static void main(String[] args) throws InterruptedException { 
        System.out.println(new TransClass().getNumber()); 
        int count = 0; 
        while (true) { 
            Thread.sleep(500); 
            count++; 
            int number = new TransClass().getNumber(); 
            System.out.println(number); 
            if (3 == number || count &gt;= 10) { 
                break; 
            } 
        } 
    } 
 }</pre></div><p>含有 agentmain 的 AgentMain 类的代码为：</p><div class="codesection"><pre class="displaycode"> import java.lang.instrument.ClassDefinition; 
 import java.lang.instrument.Instrumentation; 
 import java.lang.instrument.UnmodifiableClassException; 

 public class AgentMain { 
    public static void agentmain(String agentArgs, Instrumentation inst) 
            throws ClassNotFoundException, UnmodifiableClassException, 
            InterruptedException { 
        inst.addTransformer(new Transformer (), true); 
        inst.retransformClasses(TransClass.class); 
        System.out.println("Agent Main Done"); 
    } 
 }</pre></div><p>其中，retransformClasses 是 Java SE 6 里面的新方法，它跟 redefineClasses
                一样，可以批量转换类定义，多用于 agentmain 场合。</p><p>Jar 文件跟 Premain 那个例子里面的 Jar 文件差不多，也是把 main 和 agentmain
                的类，TransClass，Transformer 等类放在一起，打包为“TestInstrument1.jar”，而 Jar 文件当中的
                Manifest 文件为 :</p><div class="codesection"><pre class="displaycode"> Manifest-Version: 1.0 
 Agent-Class: AgentMain</pre></div><p>另外，为了运行 Attach API，我们可以再写一个控制程序来模拟监控过程：（代码片段）</p><div class="codesection"><pre class="displaycode"> import com.sun.tools.attach.VirtualMachine; 
 import com.sun.tools.attach.VirtualMachineDescriptor; 
……
 // 一个运行 Attach API 的线程子类
 static class AttachThread extends Thread { 
        
 private final List&lt;VirtualMachineDescriptor&gt; listBefore; 

        private final String jar; 

        AttachThread(String attachJar, List&lt;VirtualMachineDescriptor&gt; vms) { 
            listBefore = vms;  // 记录程序启动时的 VM 集合
            jar = attachJar; 
        } 

        public void run() { 
            VirtualMachine vm = null; 
            List&lt;VirtualMachineDescriptor&gt; listAfter = null; 
            try { 
                int count = 0; 
                while (true) { 
                    listAfter = VirtualMachine.list(); 
                    for (VirtualMachineDescriptor vmd : listAfter) { 
                        if (!listBefore.contains(vmd)) { 
 // 如果 VM 有增加，我们就认为是被监控的 VM 启动了
 // 这时，我们开始监控这个 VM 
                            vm = VirtualMachine.attach(vmd); 
                            break; 
                        } 
                    } 
                    Thread.sleep(500); 
                    count++; 
                    if (null != vm || count &gt;= 10) { 
                        break; 
                    } 
                } 
                vm.loadAgent(jar); 
                vm.detach(); 
            } catch (Exception e) { 
                 ignore 
            } 
        } 
    } 
……
 public static void main(String[] args) throws InterruptedException { 	 
     new AttachThread("TestInstrument1.jar", VirtualMachine.list()).start(); 

 }</pre></div><p>运行时，可以首先运行上面这个启动新线程的 main 函数，然后，在 5 秒钟内（仅仅简单模拟 JVM 的监控过程）运行如下命令启动测试 Jar 文件
                :</p><div class="codesection"><pre class="displaycode"> java – javaagent:TestInstrument2.jar – cp TestInstrument2.jar TestMainInJar</pre></div><p>如果时间掌握得不太差的话，程序首先会在屏幕上打出 1，这是改动前的类的输出，然后会打出一些 2，这个表示 agentmain 已经被 Attach
                API 成功附着到 JVM 上，代理程序生效了，当然，还可以看到“Agent Main Done”字样的输出。</p><p>以上例子仅仅只是简单示例，简单说明这个特性而已。真实的例子往往比较复杂，而且可能运行在分布式环境的多个 JVM 之中。</p><div class="ibm-alternate-rule"><hr></div><p class="ibm-ind-link ibm-back-to-top"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><h2 id="N1012F">Java SE 6 新特性：本地方法的
                Instrumentation</h2><p>在 1.5 版本的 instumentation 里，并没有对 Java 本地方法（Native Method）的处理方式，而且在 Java 标准的
                JVMTI 之下，并没有办法改变 method signature，
                这就使替换本地方法非常地困难。一个比较直接而简单的想法是，在启动时替换本地代码所在的动态链接库 —— 但是这样，本质上是一种静态的替换，而不是动态的
                Instrumentation。而且，这样可能需要编译较大数量的动态链接库 ——
                比如，我们有三个本地函数，假设每一个都需要一个替换，而在不同的应用之下，可能需要不同的组合，那么如果我们把三个函数都编译在同一个动态链接库之中，最多我们需要
                8 个不同的动态链接库来满足需要。当然，我们也可以独立地编译之，那样也需要 6 个动态链接库——无论如何，这种繁琐的方式是不可接受的。</p><p>在 Java SE 6 中，新的 Native Instrumentation 提出了一个新的 native code 的解析方式，作为原有的
                native method 的解析方式的一个补充，来很好地解决了一些问题。这就是在新版本的 java.lang.instrument
                包里，我们拥有了对 native 代码的 instrument 方式 —— 设置 prefix。</p><p> 假设我们有了一个 native 函数，名字叫 nativeMethod，在运行中过程中，我们需要将它指向另外一个函数（需要注意的是，在当前标准的
                JVMTI 之下，除了 native 函数名，其他的 signature 需要一致）。比如我们的 Java 代码是：</p><div class="codesection"><pre class="displaycode"> package nativeTester; 
 class nativePrefixTester{ 
	…
	 native int nativeMethod(int input); 
	…
 }</pre></div><p>那么我们已经实现的本地代码是 :</p><div class="codesection"><pre class="displaycode"> jint Java_nativeTester_nativeMethod(jclass thiz, jobject thisObj, jint input);</pre></div><p>现在我们需要在调用这个函数时，使之指向另外一个函数。那么按照 J2SE 的做法，我们可以按他的命名方式，加上一个 prefix
                作为新的函数名。比如，我们以 "another_" 作为 prefix，那么我们新的函数是 :</p><div class="codesection"><pre class="displaycode"> jint Java_nativeTester_another_nativePrefixTester(jclass thiz, jobject thisObj, 
 jint input);</pre></div><p>然后将之编入动态链接库之中。</p><p>现在我们已经有了新的本地函数，接下来就是做 instrument 的设置。正如以上所说的，我们可以使用 premain 方式，在虚拟机启动之时就载入
                premain 完成 instrument 代理设置。也可以使用 agentmain 方式，去 attach 虚拟机来启动代理。而设置 native
                函数的也是相当简单的 :</p><div class="codesection"><pre class="displaycode"> premain(){  // 或者也可以在 agentmain 里
…
 if (!isNativeMethodPrefixSupported()){ 
		 return; // 如果无法设置，则返回
 } 
 setNativeMethodPrefix(transformer,"another_"); // 设置 native 函数的 prefix，注意这个下划线必须由用户自己规定
…
 }</pre></div><p>在这里要注意两个问题。一是不是在任何的情况下都是可以设置 native 函数的 prefix 的。首先，我们要注意到 agent 包之中的
                Manifest 所设定的特性 :</p><div class="codesection"><pre class="displaycode"> Can-Set-Native-Method-Prefix</pre></div><p>要注意，这一个参数都可以影响是否可以设置 native prefix，而且，在默认的设置之中，这个参数是 false 的，我们需要将之设置成
                true（顺便说一句，对 Manifest 之中的属性来说都是大小写无关的，当然，如果给一个不是“true”的值，就会被当作 false
                值处理）。</p><p>当然，我们还需要确认虚拟机本身是否支持 setNativePrefix。在 Java API 里，Instrumentation 类提供了一个函数
                isNativePrefix，通过这个函数我们可以知道该功能是否可以实行。</p><p>二是我们可以为每一个 ClassTransformer 加上它自己的 nativeprefix；同时，每一个 ClassTransformer
                都可以为同一个 class 做 transform，因此对于一个 Class 来说，一个 native 函数可能有不同的
                prefix，因此对这个函数来说，它可能也有好几种解析方式。</p><p>在 Java SE 6 当中，Native prefix 的解释方式如下：对于某一个 package 内的一个 class 当中的一个 native
                method 来说，首先，假设我们对这个函数的 transformer 设置了 native 的
                prefix“another”，它将这个函数接口解释成 :</p><p>由 Java 的函数接口</p><div class="codesection"><pre class="displaycode"> native void method()</pre></div><p>和上述 prefix"another"，去寻找本地代码中的函数</p><div class="codesection"><pre class="displaycode"> void Java_package_class_another_method(jclass theClass, jobject thiz);  
 // 请注意 prefix 在函数名中出现的位置！</pre></div><p>一旦可以找到，那么调用这个函数，整个解析过程就结束了；如果没有找到，那么虚拟机将会做进一步的解析工作。我们将利用 Java native
                接口最基本的解析方式 , 去找本地代码中的函数 :</p><div class="codesection"><pre class="displaycode"> void Java_package_class_method(jclass theClass, jobject thiz);</pre></div><p>如果找到，则执行之。否则，因为没有任何一个合适的解析方式，于是宣告这个过程失败。</p><p>那么如果有多个 transformer，同时每一个都有自己的 prefix，又该如何解析呢？事实上，虚拟机是按 transformer 被加入到的
                Instrumentation 之中的次序去解析的（还记得我们最基本的 addTransformer 方法吗？）。</p><p>假设我们有三个 transformer 要被加入进来，他们的次序和相对应的 prefix 分别为：transformer1
                和“prefix1_”，transformer2 和 “prefix2_”，transformer3 和
                “prefix3_”。那么，虚拟机会首先做的就是将接口解析为 :</p><div class="codesection"><pre class="displaycode"> native void prefix1_prefix2_prefix3_native_method()</pre></div><p>然后去找它相对应的 native 代码。</p><p>但是如果第二个 transformer（transformer2）没有设定 prefix，那么很简单，我们得到的解析是：</p><div class="codesection"><pre class="displaycode"> native void prefix1_prefix3_native_method()</pre></div><p>这个方式简单而自然。</p><p>当然，对于多个 prefix 的情况，我们还要注意一些复杂的情况。比如，假设我们有一个 native 函数接口是：</p><div class="codesection"><pre class="displaycode"> native void native_method()</pre></div><p>然后我们为它设置了两个 prefix，比如 "wrapped_" 和 "wrapped2_"，那么，我们得到的是什么呢？是</p><div class="codesection"><pre class="displaycode"> void Java_package_class_wrapped_wrapped2_method(jclass theClass, jobject thiz); 
 // 这个函数名正确吗？</pre></div><p>吗？答案是否定的，因为事实上，对 Java 中 native 函数的接口到 native
                中的映射，有一系列的规定，因此可能有一些特殊的字符要被代入。而实际中，这个函数的正确的函数名是：</p><div class="codesection"><pre class="displaycode"> void Java_package_class_wrapped_1wrapped2_1method(jclass theClass, jobject thiz); 
 // 只有这个函数名会被找到</pre></div><p>很有趣不是吗？因此如果我们要做类似的工作，一个很好的建议是首先在 Java 中写一个带 prefix 的 native 接口，用 javah
                工具生成一个 c 的 header-file，看看它实际解析得到的函数名是什么，这样我们就可以避免一些不必要的麻烦。</p><p>另外一个事实是，与我们的想像不同，对于两个或者两个以上的 prefix，虚拟机并不做更多的解析；它不会试图去掉某一个
                prefix，再来组装函数接口。它做且仅作两次解析。</p><p>总之，新的 native 的 prefix-instrumentation 的方式，改变了以前 Java 中 native
                代码无法动态改变的缺点。在当前，利用 JNI 来写 native 代码也是 Java 应用中非常重要的一个环节，因此它的动态化意味着整个 Java
                都可以动态改变了 —— 现在我们的代码可以利用加上 prefix 来动态改变 native
                函数的指向，正如上面所说的，如果找不到，虚拟机还会去尝试做标准的解析，这让我们拥有了动态地替换 native 代码的方式，我们可以将许多带不同
                prefix 的函数编译在一个动态链接库之中，而通过 instrument 包的功能，让 native 函数和 Java
                函数一样动态改变、动态替换。</p><p>当然，现在的 native 的 instrumentation 还有一些限制条件，比如，不同的 transformer 会有自己的 native
                prefix，就是说，每一个 transformer 会负责他所替换的所有类而不是特定类的 prefix —— 因此这个粒度可能不够精确。</p><div class="ibm-alternate-rule"><hr></div><p class="ibm-ind-link ibm-back-to-top"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><h2 id="N101A1">Java SE 6
                新特性：BootClassPath / SystemClassPath 的动态增补</h2><p> 我们知道，通过设置系统参数或者通过虚拟机启动参数，我们可以设置一个虚拟机运行时的 boot class 加载路径（-Xbootclasspath）和
                system class（-cp）加载路径。当然，我们在运行之后无法替换它。然而，我们也许有时候要需要把某些 jar 加载到
                bootclasspath 之中，而我们无法应用上述两个方法；或者我们需要在虚拟机启动之后来加载某些 jar 进入 bootclasspath。在
                Java SE 6 之中，我们可以做到这一点了。</p><p> 实现这几点很简单，首先，我们依然需要确认虚拟机已经支持这个功能，然后在 premain/agantmain 之中加上需要的
                classpath。我们可以在我们的 Transformer 里使用
                appendToBootstrapClassLoaderSearch/appendToSystemClassLoaderSearch
                来完成这个任务。</p><p> 同时我们可以注意到，在 agent 的 manifest 里加入 Boot-Class-Path 其实一样可以在动态地载入 agent
                的同时加入自己的 boot class 路径，当然，在 Java code 中它可以更加动态方便和智能地完成 ——
                我们可以很方便地加入判断和选择成分。</p><p> 在这里我们也需要注意几点。首先，我们加入到 classpath 的 jar 文件中不应当带有任何和系统的 instrumentation
                有关的系统同名类，不然，一切都陷入不可预料之中 —— 这不是一个工程师想要得到的结果，不是吗？</p><p> 其次，我们要注意到虚拟机的 ClassLoader 的工作方式，它会记载解析结果。比如，我们曾经要求读入某个类
                someclass，但是失败了，ClassLoader 会记得这一点。即使我们在后面动态地加入了某一个 jar，含有这个类，ClassLoader
                依然会认为我们无法解析这个类，与上次出错的相同的错误会被报告。</p><p>再次我们知道在 Java 语言中有一个系统参数“java.class.path”，这个 property 里面记录了我们当前的
                classpath，但是，我们使用这两个函数，虽然真正地改变了实际的 classpath，却不会对这个 property 本身产生任何影响。</p><p>在公开的 JavaDoc 中我们可以发现一个很有意思的事情，Sun 的设计师们告诉我们，这个功能事实上依赖于 ClassLoader 的
                appendtoClassPathForInstrumentation 方法 ——
                这是一个非公开的函数，因此我们不建议直接（使用反射等方式）使用它，事实上，instrument
                包里的这两个函数已经可以很好的解决我们的问题了。</p><div class="ibm-alternate-rule"><hr></div><p class="ibm-ind-link ibm-back-to-top"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><h2 id="N101B5">结语</h2><p>从以上的介绍我们可以得出结论，在 Java SE 6 里面，instrumentation 包新增的功能 —— 虚拟机启动后的动态
                instrument、本地代码（native code）instrumentation，以及动态添加 classpath 等等，使得 Java
                具有了更强的动态控制、解释能力，从而让 Java 语言变得更加灵活多变。</p><p>这些能力，从某种意义上开始改变 Java 语言本身。在过去很长的一段时间内，动态
                脚本语言的大量涌现和快速发展，对整个软件业和网络业提高生产率起到了非常重要的作用。在这种背景之下，Java 也正在慢慢地作出改变。而
                Instrument 的新功能和 Script 平台（本系列的后面一篇中将介绍到这一点）的出现，则大大强化了语言的动态化和与动态语言融合，它是
                Java 的发展的值得考量的新趋势。</p><!--CMA ID: 220870--><!--Site ID: 10--><!--XSLT stylesheet used to transform this file: dw-document-html-7.0.xsl-->


</div>
</div>
<!-- 1_1_COLUMN_END -->

<!-- SPLIT_COLUMNS_BEGIN -->
<div class="ibm-columns">

<!-- 6_4_COLUMN_BEGIN -->
<div class="ibm-col-6-4">

<h2 id="resources" class="ibm-rule">参考资料 </h2><h3 class="dw-resources-category-heading">学习</h3><ul class="ibm-bullet-list"><li> 阅读 <a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse6/"><em>Java
                        SE 6 新特性系列</em></a>文章的完整列表，了解 Java SE 6 其它重要的增强。</li><li><a href="http://java.sun.com/javase/6/docs/">Java SE 6 文档</a>：Java SE 6
                的规范文档，可以找到绝大部分新特性的官方说明。</li><li><a href="http://jakarta.apache.org/bcel/index.html">Apache BCEL</a>：
                Apache BCEL 项目，可以帮助开发者操作 class 文件，开发出功能强大的 instrumentation 代理程序。</li><li> 阅读文章“<a href="http://www.ibm.com/developerworks/cn/java/j-lo-instrumentation/">Java 5 特性 Instrumentation 实践</a>”：我的同事写的文章，介绍了在 Java SE 5 环境下，利用 BCEL
                完成一个计时程序。</li><li><a href="http://www.ibm.com/developerworks/cn/java/" onmouseover="linkQueryAppend(this)">developerWorks Java
                技术专区</a>：这里有数百篇关于 Java 编程各个方面的文章。</li></ul><h3 class="dw-resources-category-heading">讨论</h3><ul class="ibm-bullet-list"><li>加入 <a href="http://www.ibm.com/developerworks/cn/community/" onmouseover="linkQueryAppend(this)">developerWorks
                中文社区</a>，查看开发人员推动的博客、论坛、组和维基，并与其他 developerWorks 用户交流。</li></ul>

<!-- INLINE_COMMENTS_BEGIN -->
<h2 id="icomments" class="ibm-alternate-rule ibm-no-print">条评论</h2>
    
<div class="ibm-no-print" id="dw-icomments-container">	
	<div id="threadShow"><img id="imgPlHdr" src="./Java-SE-6-Instrumentation_files/animated-progress-38x38c.gif" alt="" style="display: none;"><div id="cmtTog"><div class="ibm-container ibm-alternate-two dw-commentbox dw-noborder"><div class="ibm-container-body dw-commentbox dw-noborder"><p id="signInSect">请 <a onclick="var e=arguments[0] || window.event; dwsi.siInst &amp;&amp; dwsi.siInst.showSignIn(); if (e.stopPropagation){ e.stopPropagation();} else { e.cancelBubble = true; } e.preventDefault &amp;&amp; e.preventDefault(); return false;" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#">登录</a> 或 <a href="http://www.ibm.com/developerworks/dwwi/jsp/ssoregister.jsp?d=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-lo-jse61%2Findex.html%23icomments&lang=cn&a=dwmav">注册</a>  后发表评论。</p><p id="cmtHead"><label for="newCmt"><strong>添加评论:</strong></label></p><p>注意：评论中不支持 HTML 语法</p><div id="infoCmt"></div><form focus="name" enctype="multipart/form-data" method="post" action="" name="form" class="ibm-column-form ibm-styled-form"><p class="6-4-textarea"><textarea rows="5" name="newCmt" id="newCmt" class="dw-inoperable" disabled=""></textarea><br></p><span class="ibm-input-group"><input type="checkbox" value="1" name="comment_notification" id="comment_notification" disabled="disabled"><label id="notifyText" class="ibm-form-note dw-btn-cancel-sec" for="comment_notification">有新评论时提醒我</label></span><span class="ibm-form-note dw-btn-cancel-sec notifySection" id="maxCharsCount">剩余 <span id="charCount">1000</span> 字符</span><p class="ibm-buttons-row"><input type="button" value="发布" name="postCmt" id="postCmt" class="ibm-btn-sec ibm-btn-small ibm-disabled" disabled="disabled"></p></form></div></div><div class="ibm-alternate-rule"><hr></div><div id="topControl" class="ibm-container ibm-alternate-two dw-comment-totals" style="display: none;"><div class="ibm-container-body"><form id="selectComments" method="get" action=""><p>&nbsp;<span class="dw-comment-totals-label"><strong>共有评论 (<span id="numCmts">0</span>)</strong></span><span class="dw-how-many-comments-label" style="display:none" id="dropdownCmts"><label for="howManyComments"><strong>显示：</strong></label>&nbsp;<select name="comments" id="howManyComments" class="dw-how-many-comments"><option selected="selected" value="recent">最新评论 </option></select><input type="image" class="ibm-btn-go" name="ibm-go" value="Go" src="./Java-SE-6-Instrumentation_files/short-btn.gif" alt="Go"><br></span></p></form></div></div><div id="cmtSect"><div class="comment"><div class="dw-icomment-container"><table class="dw-icomment-body" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><p>快来添加第一条评论</p></td></tr></tbody></table></div></div></div></div><div id="bottomControl" class="ibm-container ibm-alternate-two dw-comment-totals" style="display:none"><div class="ibm-container-body"><form id="selectComments2" method="get" action=""><p>&nbsp;<span class="dw-comment-totals-label"><strong>共有评论 (<span id="numCmts2">0</span>)</strong></span><span class="dw-how-many-comments-label" style="display:none" id="dropdownCmts2"><label for="howManyComments2"><strong>显示：</strong></label>&nbsp;<select name="comments" id="howManyComments2" class="dw-how-many-comments"><option selected="selected" value="recent">最新评论 </option></select><input type="image" class="ibm-btn-go" name="ibm-go" value="Go" src="./Java-SE-6-Instrumentation_files/short-btn.gif" alt="Go"><br></span></p></form></div></div></div>
</div>
<!-- Sign in OVERLAY STARTS HERE -->
    
<!-- Sign in OVERLAY STARTS HERE -->
<div class="ibm-common-overlay" id="signin_overlay">
<div class="ibm-head">
<p><a class="ibm-common-overlay-close" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#" onclick="dwsi.siInst.clearForm();">关闭 [x]</a></p>
</div>
<div class="ibm-body">
<div class="ibm-main">

 <div class="ibm-title">
<h2>developerWorks: 登录</h2>
<div id="ibm-overlay-error-signin" class="no-display"></div>
</div>
<div class="ibm-container ibm-alternate ibm-buttons-last">
<div class="ibm-container-body">
<p class="ibm-overlay-intro">标有星（<span class="ibm-required">*</span>）号的字段是必填字段。</p> 
<form class="ibm-column-form" id="sFormId" action="" method="post" name="sForm" onsubmit="return false;">
<p><label for="ibmid">IBM ID:<span class="ibm-required">*</span></label><span>
    <input name="ibm-id" id="ibmid" size="25" value="" class="required" type="text" onkeypress="dwsi.siInst.handleEP(event,this.form);" aria-required="true">
    <br><a onclick="window.location=&#39;/developerworks/dwwi/DWAuthRouter?m=reg&amp;lang=zh_CN&amp;d=&#39;+encodeURIComponent(location.protocol + &#39;//&#39; + location.hostname + location.pathname + &#39;#icomments&#39;); return false;" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#" class="ibm-forward-link">需要一个 IBM ID？</a> <br>
    <a class="ibm-forward-link" href="http://www.ibm.com/developerworks/dwwi/jsp/WSHelp.jsp?lang=zh_CN">忘记 IBM ID？</a> 
</span>
</p> 
<p><label for="password">密码：<span class="ibm-required">*</span></label><span>
    <input name="password" id="password" size="25" value="" class="required" type="password" onkeypress="dwsi.siInst.handleEP(event,this.form);">
    <br><a class="ibm-forward-link" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#" onclick="(function ()
        {window.location=&#39;https://www.ibm.com/account/profile?page=forgot&amp;lang=zh_CN&amp;appname=ibm&amp;required=null&amp;d=&#39;+encodeURIComponent(dwsi.siInst.getAuthUrl())+&#39;%3Fm%3Dloginpage%26lang%3Dzh_CN%26d%3D&#39;+encodeURIComponent(location.href);})();">忘记密码？</a>
    <br><a class="ibm-forward-link" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#" onclick="(function () {window.location=&#39;https://www.ibm.com/account/profile?page=chpw&amp;lang=zh_CN&amp;appname=ibm&amp;required=null&amp;d=&#39;+encodeURIComponent(location.href);})();">更改您的密码</a></span></p> 
<p class="dw-perm-box">
	<span><input id="perm" type="checkbox" name="perm_name"><label for="perm"> 保持登录。</label></span>
</p>
<p>单击提交则表示您同意developerWorks 的条款和条件。 <a href="http://www.ibm.com/developerworks/community/terms?lang=zh">查看条款和条件</a>。</p>
<div class="ibm-buttons-row">
   <p><input class="ibm-btn-arrow-pri" name="ibm-submit" value="提交" onclick="dwsi.siInst.signin();return false;" type="submit"><span class="ibm-sep">&nbsp;</span>
<input value="取消" type="button" name="ibm-cancel" class="ibm-btn-cancel-sec" onclick="dwsi.siInst.clearForm();ibmweb.overlay.hide(&#39;signin_overlay&#39;);return false;"></p>
</div>
</form>
 <div class="ibm-overlay-rule"><hr></div> 

<p>在您首次登录 developerWorks 时，会为您创建一份个人概要。<strong>您的个人概要中的信息（您的姓名、国家/地区，以及公司名称）是公开显示的，而且会随着您发布的任何内容一起显示，除非您选择隐藏您的公司名称。</strong>您可以随时更新您的 IBM 帐户。</p>
<div><p class="dw-c-overlay-secure">所有提交的信息确保安全。</p></div>
</div>
</div>
</div>
</div>
<div class="ibm-footer"></div>
</div>
<!-- Display name OVERLAY STARTS HERE -->
<div class="ibm-common-overlay" id="displayname_overlay">
<div class="ibm-head">
<p><a class="ibm-common-overlay-close" href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#" onclick="dwsi.siInst.clearForm();">关闭 [x]</a></p>
</div>
<div class="ibm-body">
<div class="ibm-main">
<div class="ibm-title">
<h2>选择您的昵称</h2><br><br>
<div id="ibm-overlay-error-dname" class="no-display"></div>
</div>
<div class="ibm-container ibm-alternate ibm-buttons-last">
<div class="ibm-container-body">
<p class="ibm-overlay-intro">当您初次登录到 developerWorks 时，将会为您创建一份概要信息，您需要指定一个昵称。您的昵称将和您在 developerWorks 发布的内容显示在一起。</p><p><strong>昵称长度在 3 至 31 个字符之间</strong>。 
    您的昵称在 developerWorks 社区中必须是唯一的，并且出于隐私保护的原因，不能是您的电子邮件地址。</p>
<p class="ibm-overlay-intro">标有星（<span class="ibm-required">*</span>）号的字段是必填字段。</p> 
<form id="dFormId" method="post" action="" name="dForm" onsubmit="return false;" class="ibm-column-form">
<p><label for="displayname">昵称：<span class="ibm-required">*</span></label><span>
    <input name="displayname" id="displayname" size="25" value="" type="text" onkeypress="dwsi.siInst.handleEP(event,this.form);" aria-required="true"></span>
    <span class="ibm-form-note">(昵称长度在 3 至 31 个字符之间)</span>
</p>
<p>单击<strong>提交</strong>则表示您同意developerWorks 的条款和条件。 <a href="http://www.ibm.com/developerworks/community/terms?lang=zh">查看条款和条件</a>.</p>
<div class="ibm-buttons-row">
   <p><input class="ibm-btn-arrow-pri" name="ibm-submit" value="提交" onclick="dwsi.siInst.signin();return false;" type="submit"><span class="ibm-sep">&nbsp;</span>
<input value="取消" type="button" name="ibm-cancel" class="ibm-btn-cancel-sec" onclick="dwsi.siInst.clearForm();ibmweb.overlay.hide(&#39;displayname_overlay&#39;);return false;"></p>
</div>
</form>
<div class="ibm-overlay-rule"><hr></div>
<div><p class="dw-c-overlay-secure">所有提交的信息确保安全。</p></div>
</div>
</div>
</div>
</div>
<div class="ibm-footer"></div>
</div>


<!-- INLINE_COMMENTS_END -->

</div>
<!-- 6_4_COLUMN_END -->

<!-- 6_2_COLUMN_BEGIN -->
<div class="ibm-col-6-2">

<!-- Next_Steps -->
<!-- Dig_Deeper -->


<!-- Promotion_Module -->
    
<!-- PROMOTION_MODULE_START -->
<div class="ibm-alternate-rule"><hr></div>
<ul class="ibm-portrait-module-list">
<li><a class="" href="http://www.ibm.com/developerworks/cn/cloud/bluemix/" tabindex="-1" role="presentation"><img height="60" width="60" src="./Java-SE-6-Instrumentation_files/sm-f-bluemixrobot60.png" alt="IBM Bluemix 资源中心"></a>
<h3><a class="ibm-feature-link" href="http://www.ibm.com/developerworks/cn/cloud/bluemix/">IBM Bluemix 资源中心</a></h3>
<p>文章、教程、演示，帮助您构建、部署和管理云应用。</p></li>
<li><a class="" href="http://www.ibm.com/developerworks/cn/community/" tabindex="-1" role="presentation"><img height="60" width="60" src="./Java-SE-6-Instrumentation_files/sm-f-comcommunity60.png" alt="developerWorks 中文社区"></a>
<h3><a class="ibm-feature-link" href="http://www.ibm.com/developerworks/cn/community/">developerWorks 中文社区</a></h3>
<p>立即加入来自 IBM 的专业 IT 社交网络。</p></li>
<li><a class="" href="http://bluemixathon.devpost.com/" tabindex="-1" role="presentation"><img height="60" width="60" src="./Java-SE-6-Instrumentation_files/sm-f-bluemixathon60.png" alt="Bluemixathon 挑战赛"></a>
<h3><a class="ibm-feature-link" href="http://bluemixathon.devpost.com/">Bluemixathon 挑战赛</a></h3>
<p>为灾难恢复构建应用，赢取现金大奖。</p></li>
</ul>
<!-- PROMOTION_MODULE_END -->
</div>
<!-- 6_2_COLUMN_END -->

</div>
<!-- SPLIT_COLUMNS_END -->

<!-- BOTTOM_BACK_TO_TOP -->
<div class="ibm-columns">
<div class="ibm-col-1-1">
	<div class="ibm-alternate-rule"><hr></div><p class="ibm-ind-link ibm-back-to-top"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p>
</div>
</div>

<!-- Rating_Meta_BEGIN -->
<!--Rating_Meta_BEGIN--><div class="metavalue">static.content.url=http://www.ibm.com/developerworks/js/artrating/</div><div class="metavalue">SITE_ID=10</div><div class="metavalue">Zone=Java technology</div><div class="metavalue">ArticleID=220870</div><div class="metavalue">ArticleTitle=Java SE 6
            新特性: Instrumentation 新功能</div><div class="metavalue">publish-date=05162007</div><script language="javascript" type="text/javascript">document.write('<div class="metavalue">url='+location.href.replace(/</g,  '%3C')+'</div>');</script><div class="metavalue">url=http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html</div><!--Rating_Meta_END-->
<!-- Rating_Meta_END -->

</div>
<!-- END_IBM_CONTENT_MAIN -->

</div>
<!-- END_IBM_CONTENT_BODY -->

</div>
<!-- END_IBM_CONTENT -->

</div></div>
<!-- LEADSPACE_END -->


<!-- END_IBM_PCON -->
<!-- FOOTER_BEGIN -->
<div id="ibm-footer" aria-label="页脚"><!-- IBM footer container; disabled --></div>

<div id="ibm-footer-module-dwwrapper" role="contentinfo" aria-label="developerWorks Footer">

<div id="ibm-footer-module-dw">
	<div class="dw-footer-columns">
		<div class="dw-footer-col-6-1 dw-footer-col-6-1-cn">
			<ul>
				<li><a href="https://www.ibm.com/developerworks/secure/feedback.jsp?domain=dwchina" tabindex="0">帮助</a></li>
				<li><a href="http://www.ibm.com/developerworks/cn/author/" tabindex="0">联系编辑</a></li>
				<li><a href="https://www.ibm.com/developerworks/secure/myideas2.jsp?domain=dwchina" tabindex="0">提交内容</a></li>
				<li><a href="http://www.ibm.com/developerworks/cn/rss/" tabindex="0">订阅源</a></li>
			</ul>
        </div>
		<div class="dw-footer-col-6-2">
			<ul>
				<li><a href="http://www.ibm.com/vrm/newsletter/10104?S_TACT=105AGX52&S_CMP=dwcntop" tabindex="0">在线浏览每周时事通讯</a></li>
				<li><a class="dwcn-sina-link" href="http://weibo.com/ibmdw/" target="_blank" tabindex="0">新浪微博</a></li>
				<li><a href="https://www.ibm.com/developerworks/community/report?lang=zh" tabindex="0">报告滥用</a></li>
				<li><a href="https://www.ibm.com/developerworks/community/terms?lang=zh" tabindex="0">使用条款</a></li>
				<li><a href="https://www.ibm.com/developerworks/cn/community/terms/thirdparty/" tabindex="0">第三方提示</a></li>
			</ul>
		</div>
		<div class="dw-footer-col-6-3">
			<ul>
				<li><a href="http://www.ibm.com/privacy/cn/zh/" tabindex="0">隐私条约</a></li>
				<li><a href="http://www.ibm.com/ibm/accessibility/cn/" tabindex="0">浏览辅助</a></li>
				<li><a href="http://www.ibm.com/developerworks/cn/academic/" tabindex="0">IBM 教育学院教育培养计划</a></li><li><a href="http://www.ibm.com/developerworks/cn/gep/">IBM 创业企业全球扶持计划</a></li><li><a href="http://www.ibm.com/partnerworld/isv/">ISV 资源 (英语)</a></li>
			</ul>
		</div>
		<div class="dw-footer-col-6-4"> 
			<ul>
				<li><a href="http://www.ibm.com/developerworks/cn/newsletter/" tabindex="0">dW 中国每周时事通讯</a></li>
			</ul>
			
		</div>
		<div class="dw-footer-col-6-5">
			<ul>
				<li class="dw-footer-lang-head">选择语言：</li>
				<li><a href="http://www.ibm.com/developerworks/" tabindex="0">English</a></li>
				<li><a href="http://www.ibm.com/developerworks/cn/" lang="zh" tabindex="0">中文</a></li>
				<li><a href="http://www.ibm.com/developerworks/jp/" lang="ja" tabindex="0">日本語</a></li>
				<li><a href="http://www.ibm.com/developerworks/ru/" lang="ru" tabindex="0">Русский</a></li>
				<li><a href="http://www.ibm.com/developerworks/br/" lang="pt" tabindex="0">Português (Brasil)</a></li>
				<li><a href="http://www.ibm.com/developerworks/ssa/" lang="es" tabindex="0">Español</a></li>
				<li><a href="http://www.ibm.com/developerworks/vn/" lang="vi" tabindex="0">Việt</a></li>
			</ul>
		</div>
		<div class="dw-footer-col-6-6">
			<img width="223" height="46" alt="IBM®" src="./Java-SE-6-Instrumentation_files/dwn-ibm-logo-v17.png">
			<img class="dw-preload" src="./Java-SE-6-Instrumentation_files/ibm_sprite_social_blue_ON.png" alt="" width="1" height="1">
		</div>
	</div>
</div>

</div><!-- FOOTER_END -->

<!-- END_IBM-TOP -->
</div>

<!-- SCRIPTS_INCLUDE_BEGIN -->
<script type="text/javascript" src="./Java-SE-6-Instrumentation_files/dw-comments.js">//</script>
<script type="text/javascript" language="JavaScript">
	dojo.ready(function(){
		rBHash = typeof rBHash == "undefined" ? {} : rBHash;
		rBHash['viperLang'] = 'zh';
		rBHash['urlLang'] = 'cn';
		rBHash['dwwi2Lang'] = 'zh_CN';
		rBHash['appCode'] = 'dwmav';
		rBHash['signoutUrl'] = (location.host.toLowerCase() === "www.ibm.com" || location.host.toLowerCase() === "developer.ibm.com") ? 'http://www.ibm.com/developerworks/cn/' : ''; 
		dwsi.siInst = new dwweb.dynnav.dwsi();
		dwsi.siInst.initSI();		

		// construct the comment widget
dwc.cmts = '条评论';
dwc.signInPreText = '请';
dwc.signIn = '登录';
dwc.or = '或';
dwc.register = '注册';
dwc.signInPostText = '';
dwc.leaveCmt = '后发表评论。';
dwc.view = '查看';
dwc.totalCmts = '共有评论';
dwc.postYourCmt = '添加您的评论';
dwc.show = '显示：';
dwc.recentCmts = '最新评论';
dwc.allCmts = '所有评论';
dwc.tooLongCmt = '您的评论超过了 1000 字符限制';
dwc.numCharsLeft = '剩余 <span id="charCount">{1}</span> 字符';
dwc.reportAbuse = '报告滥用';
dwc.notifyMsg = '有新评论时提醒我';
dwc.htmlWarning = '注意：评论中不支持 HTML 语法'; 
dwc.cmt = '评论：';
dwc.addCmts = '添加评论';
dwc.addCmt = '添加评论';
dwc.doNotErase = '--在下方添加评论--'; 
dwc.viewOrAddCmts = '查看或添加评论';
dwc.reportInapprCont = '举报不良信息';
dwc.reportInapprContLink = 'http://www.ibm.com/developerworks/forums/forum.jspa?forumID=1834';
dwc.postingCmt = '正在发布评论……';
dwc.noCmt = '快来添加第一条评论';
dwc.netwkErr = '在检索评论时出错，请稍后刷新。';
dwc.addACmt = '添加评论';
dwc.instructCmt = '标有星号（<span class="ibm-required">*</span>）的是必填项目。';
dwc.btnPost = '发布';
dwc.btnPostAnon = '匿名发布';
dwc.btnClrCmt = '清除评论';
dwc.btnCancel = '取消';
dwc.showRecent = '显示最新的 {1} 条评论'; // {1} is the count to be substituted
dwc.showNext = '显示后 {1} 条评论'; // {1} is the count to be substituted
dwc.showAllCmts = '显示所有评论';
dwc.enterCmt = '请输入评论内容。';
dwc.loginErr = '暂时无法验证您的登录状态，请稍后再试。';
dwc.postErr = '暂时无法发布您的评论，请稍后再试。';
dwc.postBy = '由 <strong>{1}</strong>  于 {2} '; // {1} is the author to be substituted; {2} is the date
dwc.siteId = 10;
dwc.lang = 'zh_CN';
dwc.viperLang = 'zh';
//dwc.abuseHref =  null;
dwc.maxChars = 1000;
dwc.cmtTxt =  '评论：';
dwc.cmtsTxt =  '评论：';  
		dwc && new dwc.comments('threadShow','95%',5,'nCmts','icomments');
		});
</script>



<!-- BEGIN: Use this section to set page specific variables for the Unica Page Tag -->
<script language="JavaScript">var NTPT_PGEXTRA="ibmSkillLevel=3&ibmCmaId=220870&ibmContentAreas=java";</script>
<!--END --><!-- SCRIPTS_INCLUDE_END -->

<div id="ibm-metrics">
<script src="./Java-SE-6-Instrumentation_files/stats.js" type="text/javascript">//</script>
</div>



</body></html>